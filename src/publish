MAIN="$HOME/.export-commits"
MOUNT_POINT="$MAIN/mount"
LOCATION="$MAIN/output"

EXPORT_PATH_PREFIX="Dowodowki/DIGITAL"
PERSON_NAME="DIMA"
MOUNT_NAME="nelson"
MOUNT_SHARE="Projekty"
MOUNT="$MOUNT_NAME/$MOUNT_SHARE"

credentials() {
    NAME="`security find-internet-password -gs $MOUNT_NAME 2>/dev/null | grep 'acct' | cut -c 19- | tr -d '"' | tr -d '\n'`"
    PASS="`security find-internet-password -gs $MOUNT_NAME -w`"
}

mount() {
    umount "$MOUNT_POINT"
    mkdir "$MOUNT_POINT"
    mount_smbfs "//$NAME:$PASS@$MOUNT" "$MOUNT_POINT"
}

export() {
    schedule=$1
    scheduled_year=$2
    mkdir "$MOUNT_POINT/$EXPORT_PATH_PREFIX"
    mkdir "$MOUNT_POINT/$EXPORT_PATH_PREFIX/$scheduled_year"
    mkdir "$MOUNT_POINT/$EXPORT_PATH_PREFIX/$scheduled_year/$schedule"
    mkdir "$MOUNT_POINT/$EXPORT_PATH_PREFIX/$scheduled_year/$schedule/$PERSON_NAME"
    cp -a "$LOCATION/." "$MOUNT_POINT/$EXPORT_PATH_PREFIX/$scheduled_year/$schedule/$PERSON_NAME"
}

testing_output() {
    mkdir "$LOCATION"
    echo "1" >> "$LOCATION/test"
}

main() {
    schedule=$1
    scheduled_year=$2
    credentials
    mount
    export ${schedule} ${scheduled_year};
}

main "$@"